<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-GB" xml:lang="en-GB" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>UD release checklist</title>
    <link rel="root" href=""/> <!-- for JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-redmond.css"/>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <link rel="stylesheet" type="text/css" href="css/style-vis.css"/>
    <link rel="stylesheet" type="text/css" href="css/hint.css"/>
    <script type="text/javascript" src="lib/ext/head.load.min.js"></script>
    <script type="text/javascript" src="lib/ext/jquery.timeago.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js"></script>
    <script>document.addEventListener("DOMContentLoaded", function(event) {anchors.add();});</script>
    <!-- Set up this custom Google search at https://cse.google.com/cse/business/settings?cx=001145188882102106025:dl1mehhcgbo -->
    <script>
      (function() {
        var cx = '001145188882102106025:dl1mehhcgbo';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
<!--     <link rel="shortcut icon" href="favicon.ico"/> -->


  </head>
  <body>
    <div id="main" class="center">

      <div id="hp-header">
        <table width="100%"><tr><td width="50%">
          <span class="header-text"><a href="http://universaldependencies.org/#language-">home</a></span>

          <span class="header-text"><a href="https://github.com/universaldependencies/docs/edit/pages-source/release_checklist_task_force.md" target="#">edit page</a></span>
          <span class="header-text"><a href="https://github.com/universaldependencies/docs/issues">issue tracker</a></span>
        </td><td>
          <gcse:search></gcse:search>
        </td></tr></table>
      </div>

      <hr/>

      
      <div class="v2complete">
	This page pertains to UD version 2.
      </div>
      

      <div id="content">
	<noscript>
	  <div id="noscript">
	    It appears that you have Javascript disabled.
	    Please consider enabling Javascript for this page to see the visualizations.
	  </div>
	</noscript>

          <h1 id="ud-release-checklist-for-the-task-force">UD release checklist for the task force</h1>

<p>This checklist describes the steps needed in order to release a new version of the UD data.
It is meant for the maintenance task force rather than individual treebank teams.
See <a href="release_checklist.html">here</a> for the checklist for data contributors.</p>

<ul>
  <li>Freeze the list of treebanks that will be used in the shared task. There are two sources from
which the list can be derived: the online validation report, and output of <code class="highlighter-rouge">tools/check_files.pl</code>.
Save the list as <code class="highlighter-rouge">shared_task_treebanks.txt</code>.
    <ul>
      <li>Freeze the list of treebanks that are not in the shared task but will be released.
Save the list as <code class="highlighter-rouge">non_shared_task_treebanks.txt</code>.
<span style="color:blue">Then for all commands down in this checklist that say <code class="highlighter-rouge">for i in $(cat shared_task_treebanks.txt)</code>,
do the same also for <code class="highlighter-rouge">non_shared_task_treebanks.txt</code>.</span></li>
    </ul>
  </li>
  <li>Make sure that you have local clones of all UD_* repositories that should be released.
This step cannot be automated (unless you write a script that queries Github about all repositories belonging to the UniversalDependencies organization).</li>
  <li>Make sure you have the most current content of all the repositories (note that this command assumes you have not modified your local copy of the data without pushing it back; if this is the case, you will see lists of modified files in the output and you will have to resolve it). Also make sure that you are working with the <code class="highlighter-rouge">dev</code> branch:<br />
<code>for i in UD_* ; do echo $i ; cd $i ; git checkout dev ; git pull --no-edit ; cd .. ; echo ; done</code></li>
  <li>Make sure that all CoNLL-U files are formally valid
(results of the validator are <a href="http://quest.ms.mff.cuni.cz/cgi-bin/zeman/unidep/validation-report.pl">available on-line</a>
but make sure that no repository is missing there).<br />
<code>for i in $(cat released_treebanks.txt) ; do cd $i ; if [ -f *-test.conllu ] ; then for j in *.conllu ; do x=$(echo $j | perl -pe 'chomp; s/_.*//') ; if ../tools/validate.py --lang $x $j &gt;&amp; /dev/null ; then echo $j valid ; else echo $j INVALID ==================== ; fi ; done ; fi ; cd .. ; done</code></li>
  <li>Make sure that there are not significant overlaps between training and dev/test files of treebanks of one language.<br />
<code>check_overlaps.pl $(cat released_treebanks.txt) |&amp; tee overlap.log</code></li>
  <li>Run <code class="highlighter-rouge">tools/check_files.pl |&amp; tee release-2.2-report.txt | less</code>.
(Its source code was temporarily modified to contain the list of shared task treebanks and only look at these!)
It will visit all UD_* repositories and report any missing files, unexpected or unexpectedly named files.
It will also collect information such as the list of contributors (we need this metadata for Lindat).</li>
  <li>Update statistics in the <code class="highlighter-rouge">stats.xml</code> file in each repository:<br />
<code>for i in $(cat released_treebanks.txt) ; do echo $i ; cd $i ; ( cat *.conllu | ../tools/conllu-stats.pl &gt; stats.xml ) ; git add stats.xml ; git commit -m 'Updated statistics.' ; git push ; cd .. ; echo ; done</code></li>
  <li>Merge the <code class="highlighter-rouge">dev</code> branch into <code class="highlighter-rouge">master</code> in the released repositories.
The <code class="highlighter-rouge">master</code> branch should not be touched the next seven months and it should have exactly the contents that was officially
released and used in the shared task.<br />
<code>for i in $(cat released_treebanks.txt) ; do echo $i ; cd $i ; git checkout master ; git pull --no-edit ; git merge dev --no-edit ; git push ; git checkout dev ; cd .. ; echo ; done</code></li>
  <li>Check for conflicts from the previous step. If people misbehaved and pushed commits to <code class="highlighter-rouge">master</code>, even after a revert automatic merging may no longer be possible. We must resolve all conflicts manually before going on! The conflicted repositories are still switched to the <code class="highlighter-rouge">master</code> branch and git will not allow any further operations with them!<br />
<code>for i in $(cat released_treebanks.txt) ; do echo $i ; cd $i ; if ( git status | grep conflict ) ; then echo XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX CONFLICT XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX ; sleep 2 ; else echo OK ; fi ; cd .. ; echo ; done</code>
    <ul>
      <li><code>cd UD_...(the-one-with-conflict) ; git status</code> will show what files have a problem. Let’s assume that only <code class="highlighter-rouge">README.txt</code> has a problem. This is how we replace it with the version from the <code class="highlighter-rouge">dev</code> branch and conclude the merge:<br />
<code>git checkout --theirs README.txt ; git add README.txt ; git commit -m 'Merge branch dev' ; git push ; git checkout dev ; cd ..</code></li>
    </ul>
  </li>
  <li>After resolving the conflicts do not forget to checkout the <code class="highlighter-rouge">dev</code> branch again! (If there were no conflicts, we are already back in <code class="highlighter-rouge">dev</code>.)<br />
<code>for i in $(cat released_treebanks.txt) ; do echo $i ; cd $i ; git checkout dev ; cd .. ; echo ; done</code></li>
  <li>Re-evaluate the treebanks for the star ranking on the website. This is done only in the master branch and the result is stored there.<br />
<code>for i in $(cat released_treebanks.txt) ; do echo $i ; cd $i ; git checkout master ; cd .. ; perl -I tools tools/evaluate_treebank.pl $i --verbose &gt;&amp; $i/eval.log ; cd $i ; git add eval.log ; git commit -m 'Updated treebank evaluation.' ; git push ; git checkout dev ; cd .. ; done</code></li>
  <li>Run the script that refreshes the title page of Universal Dependencies (list of languages, treebanks and their properties).<br />
<code>cd docs-automation ; make all<br />(and git commit ; git push)</code></li>
  <li>Tag the current commit in all repositories with the tag of the current release (<code class="highlighter-rouge">git tag r2.2</code> for UD 2.2).
Push the tag to Github: <code class="highlighter-rouge">git push origin --tags</code>.
You may even tag a particular commit retroactively: <code class="highlighter-rouge">git tag -a r2.1 9fceb02</code>.
If the repository is updated after you assigned the tag and you need to re-assign the tag to a newer commit,
this is how you remove the tag from where it is now: <code class="highlighter-rouge">git tag -d r2.1</code>.
And this is how you remove it from Github: <code class="highlighter-rouge">git push origin :refs/tags/r2.1</code>.
WARNING: The following command tags all UD repositories, including those that are not part of the current release.<br />
<code>for i in $(cat released_treebanks.txt) docs tools ; do echo $i ; cd $i ; git tag r2.2 ; git push --tags ; cd .. ; echo ; done</code></li>
  <li>Run the script <tt>tools/package_ud_release.sh</tt>, which must find the release number in the environment,
and its arguments are names of folders to be released.<br />
<code>RELEASE=2.2 tools/package_ud_release.sh $(cat released_treebanks.txt)</code></li>
  <li>Tell Anša Vernerová that she can start importing the data to Kontext (ideally the announcement about the release would include links to PML-TQ, Kontext and SETS).</li>
  <li>Run the same script again (but with different settings) and generate the long statistics that are displayed in the docs:<br />
<code>cd docs ; git pull --no-edit ; cd .. ; for i in $(cat released_treebanks.txt) ; do echo $i ; tools/conllu-stats.pl --oformat newdetailed --treebank $i --docs docs ; echo ; done ; cd docs ; git add treebanks/*/*.md ; git commit -m 'Updated statistics.' ; git push ; cd ..</code></li>
  <li>Generate side-by-side comparison whenever there are multiple treebanks of one language:<br />
<code>perl tools/generate_comparison_of_treebanks.pl ; cd docs ; git add treebanks/*-comparison.md ; git commit -m 'Updated comparison of treebanks.' ; git push ; cd ..</code></li>
  <li>Run two other scripts that generate the lists of language-specific features and dependency relation subtypes for the docs repository. Note that the first script does not directly rewrite the page in the docs repository, we must redirect its STDOUT there. The second script, <code>survey_deprel_subtypes.pl</code>, accesses directly <code>docs/ext-dep-index.md</code>. Also note: these two scripts currently collect labels from all treebanks in their sight. However, we probably want to list only the labels found in the data to be released! The first script now has the option <code>--datapath</code>, which can be used to redirect the script to a copy of the UD folder where only approved treebank versions are visible. Once the two files are updated, we must commit and push them to Github of course.<br />
<code>perl tools/survey_features.pl &gt; docs/ext-feat-index.md ; perl tools/survey_deprel_subtypes.pl ; cd docs ; ...</code></li>
  <li>Make the release packages temporarily available for download somewhere and ask the treebank providers to check them before we archive them in Lindat.</li>
  <li>Update the list of licenses for Lindat. See the <a href="https://github.com/UniversalDependencies/LICENSE">LICENSE repository</a>.
Send the new list to Lindat so they add it to their menu (they like to get it as a diff file against the previous license;
they can be reached at lindat-help@ufal.mff.cuni.cz).</li>
  <li>Once the Lindat staff make the new license list available in their system, we can
<a href="https://lindat.mff.cuni.cz/repository/xmlui/submit">create a new Lindat item</a> for the new version of UD.
(The server starts by asking you to “select a community”. Choose LINDAT / CLARIN.
In the note for the editors (last page of the form), ask them to mark the previous UD release as obsolete and to add a link
pointing from the previous release to the new one.)
Note that the Lindat staff may help to automate other tasks as well.
For example, we have an extraordinarily long list of authors. Instead of typing them on the Lindat website one-by-one,
they can batch-upload the list we send them. Once everything is ready and we submit the item, they will review it and assign
the persistent URL (handle.net) to the item; that is the URL that we want to publish on the UD website. At that moment the
release is officially out and no changes to the data files are permitted (changes to metadata are possible if necessary,
but this is done on demand only).</li>
  <li>Update the title page of Universal Dependencies. Send out announcement to ud@stp.lingfil.uu.se, corpora@uib.no, ACL list etc.</li>
  <li>Upload the data to the search engines (SETS, PML-TQ, Kontext etc.)</li>
</ul>

<p><small><code style="color:lightgrey">
path=$(pwd) ;
cd /net/data ;
tar xzf $path/release-2.2/ud-treebanks-v2.2.tgz ;
mv ud-treebanks-v2.2 universal-dependencies-2.2 ;
cd $HAMLEDT ;
perl ./populate_ud22.pl ;
\# copy metadata to biblio
\# add list of treebanks to $HAMLEDT/normalize/Makefile
make qpmltq ;
</code></small></p>


      </div>

<!-- support for embedded visualizations -->
<script type="text/javascript">
    var root = ''; // filled in by jekyll
    head.js(
        // External libraries
        root + 'lib/ext/jquery.min.js',
        root + 'lib/ext/jquery.svg.min.js',
        root + 'lib/ext/jquery.svgdom.min.js',
        root + 'lib/ext/jquery.timeago.js',
        root + 'lib/ext/jquery-ui.min.js',
        root + 'lib/ext/waypoints.min.js',
        root + 'lib/ext/jquery.address.min.js',

        // brat helper modules
        root + 'lib/brat/configuration.js',
        root + 'lib/brat/util.js',
        root + 'lib/brat/annotation_log.js',
        root + 'lib/ext/webfont.js',
        // brat modules
        root + 'lib/brat/dispatcher.js',
        root + 'lib/brat/url_monitor.js',
        root + 'lib/brat/visualizer.js',

        // embedding configuration
        root + 'lib/local/config.js',
        // project-specific collection data
        root + 'lib/local/collections.js',

        // Annodoc
        root + 'lib/annodoc/annodoc.js',

        // NOTE: non-local libraries
        'https://spyysalo.github.io/conllu.js/conllu.js'
    );

    var webFontURLs = [
//        root + 'static/fonts/Astloch-Bold.ttf',
        root + 'static/fonts/PT_Sans-Caption-Web-Regular.ttf',
        root + 'static/fonts/Liberation_Sans-Regular.ttf'
    ];

    var setupAccordions = function() {
	// preserve state in URL hash, following in part
	// http://www.boduch.ca/2011/05/remembering-jquery-ui-accordion.html

        // Make subaccordions first, make them active to get height, and then close later
        $(".jquery-ui-subaccordion-closed").accordion({collapsible: true, disabled:false, active:0});

	var accordionChange = function(event, ui) {
	    var context = ui.newHeader ? ui.newHeader.context : null;
	    if (context) {
		var languageCode = context.getAttribute('data-lc');
		if (languageCode !== null) {
		    window.location.hash = languageCode;
		}
	    }
	}
        // jQuery UI "accordion" element initialization
	$(".jquery-ui-accordion").accordion({
	    collapsible: true,
	    active: false,
	    change: accordionChange
	});
	if ($(".jquery-ui-accordion").length) {
	    var matches = window.location.hash.match(/^\#(.*)$/);
	    console.log(matches);
	    if (matches !== null) {
		var languageCode = matches[1];
		var tab = $('[data-lc="'+languageCode+'"]');
		// the following will only work after accordion is initialized
		var index = $('.jquery-ui-accordion div.ui-accordion-header').index(tab);
		if (index !== -1) {
		    $(".jquery-ui-accordion").accordion({ active: index });
		}
	    }
	}
        //now reclose these accordions
        $(".jquery-ui-subaccordion-closed").accordion("option","active",false);
    };

    var setupTimeago = function() {
        jQuery("time.timeago").timeago();
    };

    var setupTabs = function() {
        // standard jQuery UI "tabs" element initialization
        $(".jquery-ui-tabs").tabs({ heightStyle: "auto" });

        // use jQuery address to preserve tab state
        // (see https://github.com/UniversalDependencies/docs/issues/65,
        // http://stackoverflow.com/a/3330919)
        if ($(".jquery-ui-tabs").length > 0) {
            $.address.change(function(event){
	        $(".jquery-ui-tabs").tabs("select", window.location.hash)
	    });
	    $(".jquery-ui-tabs").bind("tabsselect", function(event, ui) { 
	        window.location.hash = ui.tab.hash;
	    });
        }
    };

    head.ready(function() {
        // set up UI tabs on page
        setupTabs();
        setupAccordions();
        setupTimeago();

        // mark current collection (filled in by Jekyll)
        Collections.listing['_current'] = '';

	// perform all embedding and support functions
	Annodoc.activate(Config.bratCollData, Collections.listing);
    });
</script>


<!-- google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55233688-1', 'auto');
  ga('send', 'pageview');

</script>


      <div id="footer">
	  <p class="footer-text">&copy; 2014–2017
	    <a href="http://universaldependencies.org/introduction.html#contributors" style="color:gray">Universal Dependencies contributors</a>.
	    Site powered by <a href="http://spyysalo.github.io/annodoc" style="color:gray">Annodoc</a> and <a href="http://brat.nlplab.org/" style="color:gray">brat</a></p>.
      </div>
    </div>
  </body>
</html>
